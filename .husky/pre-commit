# 1. Generate OpenAPI and add if changed
echo "Generating OpenAPI..."
yarn openapi:generate || exit 1
if [ -f openapi.json ]; then
  yarn format openapi.json >/dev/null 2>&1 || true
  git add openapi.json || true
fi

# 2. Lint staged files
yarn lint-staged || exit 1

# 3. Type-check
yarn type-check || exit 1

# 4. Skip heavy steps if WIP flag exists
if [ -f .git/SKIP_BUILD_FLAG ]; then
  echo "WIP flag present; skipping build"
  exit 0
fi

# 5. Build
yarn build || exit 1
